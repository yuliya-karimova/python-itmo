name: Deploy MkDocs to GitHub Pages

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install Python deps
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs   # mkdocs-material —É–±–µ—Ä–∏, –µ—Å–ª–∏ –ø–µ—Ä–µ—à—ë–ª –Ω–∞ —Å–≤–æ—é —Ç–µ–º—É

      # üëá –î–û–ë–ê–í–õ–ï–ù–û: Node –¥–ª—è PostCSS/–≤–∞–ª–∏–¥–∞—Ü–∏–∏/–º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏
      - uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install Node deps
        run: |
          if [ -f package-lock.json ]; then npm ci; else npm i; fi

      - name: Build MkDocs (to site/)
        run: mkdocs build --strict --site-dir ./site

      # üëá –î–û–ë–ê–í–õ–ï–ù–û: PostCSS (autoprefixer + cssnano)
      - name: PostCSS build
        run: npm run postcss
        # –æ–∂–∏–¥–∞–µ—Ç scripts.postcss –≤ package.json –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ docs/assets/css/main.css

      # üëá –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è HTML
      - name: Validate HTML
        run: npm run html:validate

      # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —É–ª—É—á—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∏
      # - name: Typography
      #   run: npm run html:typo

      # üëá –î–û–ë–ê–í–õ–ï–ù–û: –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è HTML
      - name: Minify HTML
        run: npm run html:minify

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: "./site"

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    steps:
      - name: Deploy
        uses: actions/deploy-pages@v4
